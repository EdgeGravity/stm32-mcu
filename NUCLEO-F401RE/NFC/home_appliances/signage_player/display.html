<!DOCTYPE html>
<html>
<head>
  <title>Display</title>
  <meta name="mobile-web-app-capable" content="yes">
  <link href="css/display.css" rel="stylesheet" type="text/css">
  <script src="https://jp.vuejs.org/js/vue.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
  <script src="./script/uuid.js"></script>
</head>

<body>
  <div id="app">
    <img id="image" v-bind:src="src">
  </div>
  
  <script>
  let app = new Vue({
    el: '#app',
    data: {
      src: ''
    }
  });

  app.src = './images/korean_noodles1.jpg'
  </script>
 
<script>
function connect() {
  const host = window.location.hostname;
  //const port = 11883  // MQTT over WebSocket
  const port = 18883  // MQTT over WebSocket
  mqtt = new Paho.MQTT.Client(host, port, uuidv4());

  let options = {
    timeout: 3,
    onSuccess: onConnect,
    useSSL: true
  };
  mqtt.onMessageArrived = onMessageArrived;
  mqtt.connect(options);
  console.log('Connecting to MQTT server: ' + host)
}

function onConnect() {
  console.log('Connected to MQTT server');
	mqtt.subscribe('display');
}

function onMessageArrived(msg) {
  let data = msg.payloadString;
  switch (data) {
    case '1':
      app.src = './images/korean_noodles1.jpg';
      break;
    case '2':
      app.src = './images/korean_noodles2.jpg';
      break;
    default:
      break;
  }
  console.log(data);
}

connect();

</script>
</body>

</html>

