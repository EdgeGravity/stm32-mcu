# Dynamic NFC tag (STMicro's ST25DV04K)

## Dynamic NFC tag "ST25"

ST25 supports bi-directional communication in a passive way, so it can be thought of as a reader/writer powerd by a smartphone via RF.

## My interests

Think different -- IoT in a different way.

## Service enabled by ST25

[1] A smart phone initiates a service.

```
   Sleeping                                         
    [STM32]          [ST25]<---RF----[Smart phone] User
      ^               GPO                           
      |                |
      +----------------+
           Interrupt
```

[2] The system wakes up and prepares a service for the user in a very short time.

```
[Local service function]
       |
       +-------------[Sensor] ((( shape, color, temperature ...
       |
       v
    [STM32]          [ST25]<---RF----[Smart phone] User
Service preparation  
```

[3] The system provides a service URL to the smartphone.

```
    [STM32]---I2C--->[ST25]----RF--->[Smart phone]----GET---->[Web application server]
                             (URL)
```

[4] The smartphone fetchs the page from a web server.

```
    [STM32]          [ST25]          [Smart phone]<---200 OK--[Web application server]
```

## Platform

### Smart phones

- Android
- iPhone "Core NFC": https://www.idownloadblog.com/2018/09/14/apple-core-nfc-background-tag-reading/

### Dynamic NFC tag

Current implementation:
- [NUCLEO F401RE](https://www.st.com/en/evaluation-tools/nucleo-f401re.html)
- [X-NUCLEO-NFC04A1(ST25DV04K)](https://www.st.com/en/ecosystems/x-nucleo-nfc04a1.html)

### Web application server

- Node.js with express.js
- SQLite

## Software toolchain

- TrueSTUDIO

## Code

### MCU with ST25

==> **[code](./stm32/Dynamic_NFC)**

- The code supports power management for the MCU.
- The code puts the MCU into sleep after start up, so TrueSTUDIO on my PC cannot communicate with the MCU. In this case, hold a smart phone over the antenna to keep the MCU awaken.
- To disable the power management (to use GPO on PA9 as an interrupt to signal RF change to MCU), just comment out the following line:

main.c
```
#define SLEEP_ENABLED
```

### HTTPS web application server

This is just a skeltpne of web application server.

==> **[code](./node)**

### Android-native app for more advanced services

TODO: p2p data transfer scenarios using ST25 mailbox, other than NDEF messages.

### Web NFC for dynamic tag NFC management

It is pure experimental -- although Web NFC is interesting, iPhone does not support it, and Chrome users need to access "chrome://flags" to enable Web NFC.

TODO

## A bug in X-CUBE-NFC4/CubeMX

BSP folder is removed whenever code is generated by CubeMX after the initial generation. Copy BSP into the folder manually to cope with the problem.

## References

- [ST25DV04K(Dynamic NFC tag)](https://www.st.com/en/nfc/st25dv04k.html)
- ["NFC Tap" Android app for ST25](https://www.st.com/content/st_com/en/products/embedded-software/st25-nfc-rfid-software/stsw-st25001.html)
- [ST25 SDK(jar)](https://my.st.com/content/my_st_com/en/products/embedded-software/st25-nfc-rfid-software/stsw-st25sdk001.html)
- [ST25 Webapp(html5)](https://smarter.st.com/st25-nfc-web-application/?icmp=tt7281_gl_lnkon_may2018)
